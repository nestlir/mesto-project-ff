(()=>{"use strict";var t=document.forms["edit-profile"],e=document.forms["new-place"],n=document.forms["edit-avatar"],r=document.forms["delete-card"],o=(document.querySelector(".popup_type_image"),document.querySelector(".profile__edit-button")),c=document.querySelector(".profile__add-button"),a=Array.from(document.querySelectorAll(".popup")),i=document.querySelector(".popup_type_edit"),u=document.querySelector(".popup_type_new-card"),l=document.querySelector(".popup_type_avatar"),s=document.querySelector(".popup_type_delete-card"),d=document.querySelector(".places__list"),p=document.querySelector(".profile__image"),f=document.querySelector(".popup__input_type_name"),m=document.querySelector(".popup__input_type_description"),v=document.querySelector(".profile__title"),_=document.querySelector(".profile__description"),y=e.elements["place-name"],h=e.elements.link,b=(document.querySelector(".popup__caption"),document.querySelector(".popup__image"),function(t){if("Escape"===t.key){var e=a.find((function(t){return t.classList.contains("popup_is-opened")}));e&&k(e)}}),S=function(t){t.target===t.currentTarget&&k(t.target)},C=function(t){var e=t.target.closest(".popup");k(e)},g=function(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",b)},k=function(t){t&&(t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",b))},E="users/me",L="cards",q="likes",A={Authorization:"14b58559-029e-496e-9a10-e787d4f1cf4c","Content-Type":"application/json"},x=function(t){return t.ok?t.json():Promise.reject("Error: ".concat(t.status))};function T(t,e){return fetch("".concat("https://nomoreparties.co/v1/wff-cohort-9","/").concat(t),e).then(x)}function w(t,e,n){var r=e.deleteCardCallback,o=e.openImageCallback,c=e.handleLikesCallback,a=e.popupImage,i=e.popupImageCaption,u=e.buttonTypeCard,l=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),s=l.querySelector(".card__image"),d=l.querySelector(".card__title"),p=l.querySelector(".card__like-button"),f=l.querySelector(".card__like-counter");s.src=t.link,s.alt=t.name,d.textContent=t.name,f.textContent=t.likes.length;var m=l.querySelector(".card__delete-button");return n!==t.owner._id?m.style.display="none":m.addEventListener("click",(function(){var e=t._id;r(l,e)})),t.likes.some((function(t){return t._id===n}))&&p.classList.add("card__like-button_is-active"),p.addEventListener("click",(function(){c(f,p,t)})),s.addEventListener("click",(function(){o(s,a,i,u)})),l}var j,O,I={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".button",inactiveButtonClass:"button_inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"},B=function(t,e,n){var r=t.querySelector(".".concat(e.id,"-error"));r&&(e.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent="")},P=function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(n.removeAttribute("disabled",!1),n.classList.remove(e.inactiveButtonClass)):(n.setAttribute("disabled",!0),n.classList.add(e.inactiveButtonClass))};function D(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);n.forEach((function(n){return B(t,n,e)})),P(n,e,r)}function M(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранение...";e.textContent=t?r:n}function N(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранение...";e.preventDefault();var r=e.submitter,o=r.textContent;M(!0,r,o,n),t().then((function(){e.target.reset()})).catch((function(t){console.error("Ошибка: ".concat(t))})).finally((function(){M(!1,r,o,n)}))}function H(){f.value=v.textContent,m.value=_.textContent}function J(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}!function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){!function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);n.forEach((function(o){o.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.error):e.setCustomValidity(""),e.validity.valid?B(t,e,n):function(t,e,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(n.inputErrorClass),r.textContent=e.validationMessage,r.classList.add(n.errorClass)}(t,e,n)}(t,o,e),P(n,e,r)}))}))}(e,t)}))}(I);var G={deleteCardCallback:function(t,e){j=t,O=e,g(s)},openImageCallback:function(t,e,n,r){e.src=t.src,e.alt=t.alt,n.textContent=t.alt,g(r)},handleLikesCallback:function(t,e,n){e.classList.contains("card__like-button_is-active")?function(t){return T("".concat(L,"/").concat(q,"/").concat(t),{method:"DELETE",headers:A})}(n._id).then((function(n){e.classList.toggle("card__like-button_is-active"),t.textContent=n.likes.length})).catch((function(t){console.error("Произошла ошибка при удалении лайка:",t)})):function(t){return T("".concat(L,"/").concat(q,"/").concat(t),{method:"PUT",headers:A})}(n._id).then((function(n){e.classList.toggle("card__like-button_is-active"),t.textContent=n.likes.length})).catch((function(t){console.error("Произошла ошибка при добавлении лайка:",t)}))}};o.addEventListener("click",(function(){D(t,I),H(),g(i)})),c.addEventListener("click",(function(){D(u,I),g(u)})),p.addEventListener("click",(function(){D(l,I),g(l)})),a.forEach((function(t){var e=t.querySelector(".popup__close");t.addEventListener("click",S),e.addEventListener("click",C)}));var U="";i.addEventListener("submit",(function(t){N((function(){return(e=f.value,n=m.value,T(E,{method:"PATCH",headers:A,body:JSON.stringify({name:e,about:n})})).then((function(e){v.textContent=e.name,_.textContent=e.about,H(),k(t.target.closest(".popup_is-opened"))}));var e,n}),t)})),u.addEventListener("submit",(function(t){!function(t,e,n){N((function(){return(t=y.value,r=h.value,T(L,{method:"POST",headers:A,body:JSON.stringify({name:t,link:r})})).then((function(t){var r=w(t,e,n);d.prepend(r),k(u)}));var t,r}),t)}(t,G,U)})),l.addEventListener("submit",(function(t){N((function(){return(t=n.elements["avatar-link"].value,T("".concat(E,"/avatar"),{method:"PATCH",headers:A,body:JSON.stringify({avatar:t})})).then((function(t){p.setAttribute("style","background-image: url('".concat(t.avatar,"')")),k(l)}));var t}),t)})),r.addEventListener("submit",(function(t){t.preventDefault(),function(t,e){(function(t){return T("".concat(L,"/").concat(t),{method:"DELETE",headers:A})})(e).then((function(){t.remove(),k(s)})).catch((function(t){console.error("Произошла ошибка при удалении карточки:",t)}))}(j,O)})),Promise.all([T(E,{method:"GET",headers:A}),T(L,{method:"GET",headers:A})]).then((function(t){var e,n,r=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,c,a,i=[],u=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=c.call(n)).done)&&(i.push(r.value),i.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return i}}(e,n)||function(t,e){if(t){if("string"==typeof t)return J(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?J(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],c=r[1];!function(t){v.textContent=t.name,_.textContent=t.about,p.setAttribute("style","background-image: url('".concat(t.avatar,"')")),U=t._id}(o),function(t,e,n){d.innerHTML="",t.forEach((function(t){var r=w(t,e,n);d.appendChild(r)}))}(c,G,o._id)})).catch((function(t){console.error("Произошла ошибка при получении данных:",t)}))})();